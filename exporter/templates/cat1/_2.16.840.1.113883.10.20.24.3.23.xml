<entry>
  <encounter classCode="ENC" moodCode="ENV">
    <!-- Encounter activities template -->
    <templateId root="2.16.840.1.113883.10.20.22.4.49" {{if isR2 .EntrySection}}{{else}}extension="2014-06-09"{{end}} />
    <!-- Encounter performed template -->
    <templateId root="2.16.840.1.113883.10.20.24.3.23" {{if isR2 .EntrySection}}{{else}}extension="2014-12-01"{{end}} />
    <id root="1.3.6.1.4.1.115" extension="{{newRandom}}"/>
    {{/*$extraContent := "sdtc:valueSet=\"#{value_set_oid}\""*/}}

    {{template "_code.xml" codeDisplayWithPreferredCode .EntrySection.Entry .EntrySection.Entry.Coded "entryCode"}}
    <text>{{.EntrySection.Description}}</text>
    <statusCode code="completed"/>
    <effectiveTime>
      <!-- We try to look for the admit/discharge times on the encounter if they are there. If not, we fall back to the typical start/end date. -->
      {{$startTime := condAssign .EntrySection.AdmitTime .EntrySection.StartTime}}
      {{$endTime := condAssign .EntrySection.DischargeTime .EntrySection.EndTime}}
      <low {{valueOrNullFlavor $startTime}}/>
      <high {{valueOrNullFlavor $endTime}}/>
    </effectiveTime>
    {{if .EntrySection.DischargeDisposition}}
      {{dischargeDispositionDisplay .EntrySection.DischargeDisposition}}
    {{end}}

    {{/* - - - facility code goes here - - - */}}

    {{if isR2 .EntrySection}}
      {{if .EntrySection.TransferFrom}}
        <participant typeCode="ORG">
          <!-- Transfer From (Destination) template -->
          <templateId root="2.16.840.1.113883.10.20.24.3.81"/>
          <time {{valueOrNullFlavor .EntrySection.TransferFrom.Time}}/>
          <participantRole classCode="LOCE">
            {{/* NOTE: did not add transfer_vs_map to options hash. should I do this? */}}
            {{/*$transferOid := getTransferOid .MapDataCriteria.DataCriteria "TRANSFER_FROM"*/}}
            {{/*$vsTag := sdtcValueSetAttribute $transferOid*/}}
            {{/*codeDisplay .EntrySection $options*/}}
            {{/*codeDisplay .EntrySection ""*/}}
            {{template "_code.xml" codeDisplayWithPreferredCode .EntrySection.Entry .EntrySection.TransferFrom.Coded "transferFrom"}}
          </participantRole>
        </participant>
      {{end}}
      {{if .EntrySection.TransferTo}}
        <participant typeCode="DST">
          <!-- Transfer To (Destination) template -->
          <templateId root="2.16.840.1.113883.10.20.24.3.82"/>
          <time {{valueOrNullFlavor .EntrySection.TransferTo.Time}}/>
          <participantRole classCode="LOCE">
            {{/* NOTE: did not add transfer_vs_map to options hash. should I do this? */}}
            {{/*$transferOid := getTransferOid .MapDataCriteria.DataCriteria "TRANSFER_TO"*/}}
            {{/*$vsTag := sdtcValueSetAttribute $transferOid*/}}
            {{/*codeDisplay .EntrySection $options*/}}
            {{/*codeDisplay .EntrySection ""*/}}
            {{template "_code.xml" codeDisplayWithPreferredCode .EntrySection.Entry .EntrySection.TransferTo.Coded "transferTo"}}
          </participantRole>
        </participant>
      {{end}}
    {{end}}
    {{if .EntrySection.Reason}}
      {{template "_reason.xml" .}}
    {{end}}
  </encounter>
</entry>